(function(){"use strict";function x(t,r,i){const a=new Uint8ClampedArray(t.length);let l=0,s=0,c=0,e=0,n=0,o=0;for(let f=0;f<a.length;++f)o=t[f],l=o&255,s=o>>8&255,c=o>>16&255,e=(o>>24&255)/255,e<1&&i?(e=1-e,l+=(255-l)*e,s+=(255-s)*e,c+=(255-c)*e):(l*=e,s*=e,c*=e),n=l*.2125+s*.7154+c*.0721,n+=(r-128)*(1-n/255)*(n/255)*2,a[f]=n;return a}function g(t,r,i){return t+r*i}function m(t,r){const i=new Uint32Array(t.length);for(let a=0;a<t.length;++a){const l=t[a]===255&&r?0:4278190080;i[a]=l|t[a]<<16|t[a]<<8|t[a]}return i}function y(t,r,i,a,l){let s=t;for(let e=0;e<i;e++)for(let n=0;n<r;n++){let o=s[g(n,e,r)],f=Math.round(o*l/255)*(255/l),p=o-f;s[g(n,e,r)]=f;for(let[d,u,A,b]of a)n+d>=0&&n+d<r&&e+u>=0&&e+u<i&&(s[g(n+d,e+u,r)]+=p*A/b)}return new ImageData(new Uint8ClampedArray(m(s,!0).buffer),r,i)}function h(t){switch(t){case 0:return{name:"Floyd-Steinberg",pixelData:[[1,0,7,16],[-1,1,3,16],[0,1,5,16],[1,1,1,16]]};case 1:return{name:"Atkinson Algorithm",pixelData:[[1,0,1,8],[2,0,1,8],[-1,1,1,8],[0,1,1,8],[1,1,1,8],[0,2,1,8]]};case 2:return{name:"Jarvis, Judice, and Ninke Dithering",pixelData:[[1,0,7,48],[2,0,5,48],[-2,1,3,48],[-1,1,5,48],[0,1,7,48],[1,1,5,48],[2,1,3,48],[-2,2,1,48],[-1,2,3,48],[0,2,5,48],[1,2,3,48],[2,2,1,48]]}}}self.addEventListener("message",t=>{const{data:r,type:i,w:a,h:l,brightness:s,factor:c}=t.data,e=new Uint32Array(r),n=x(e,s,!0);self.postMessage({data:{arr:y(n,a,l,h(i).pixelData,1),name:h(i).name},type:i,w:a,h:l})})})();
